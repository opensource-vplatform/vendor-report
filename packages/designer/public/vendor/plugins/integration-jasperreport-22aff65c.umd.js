!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):((t="undefined"!=typeof globalThis?globalThis:t||self).TOONE=t.TOONE||{},t.TOONE.JasperReportTransform=r())}(this,(function(){"use strict";function t(r){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(r)}function r(r){var e=function(r,e){if("object"!=t(r)||!r)return r;var n=r[Symbol.toPrimitive];if(void 0!==n){var o=n.call(r,e||"default");if("object"!=t(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(r)}(r,"string");return"symbol"==t(e)?e:String(e)}function e(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,r(o.key),o)}}function n(t,e,n){return(e=r(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function o(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function i(t,r){if(t){if("string"==typeof t)return o(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?o(t,r):void 0}}function a(t){return function(t){if(Array.isArray(t))return o(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||i(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t,r){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t})(t,r)}function u(t,r){return function(t){if(Array.isArray(t))return t}(t)||function(t,r){var e=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=e){var n,o,i,a,l=[],u=!0,c=!1;try{if(i=(e=e.call(t)).next,0===r){if(Object(e)!==e)return;u=!1}else for(;!(u=(n=i.call(e)).done)&&(l.push(n.value),l.length!==r);u=!0);}catch(d){c=!0,o=d}finally{try{if(!u&&null!=e.return&&(a=e.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(t,r)||i(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(){c=function(t,r){return new e(t,void 0,r)};var t=RegExp.prototype,r=new WeakMap;function e(t,n,o){var i=new RegExp(t,n);return r.set(i,o||r.get(t)),l(i,e.prototype)}function n(t,e){var n=r.get(e);return Object.keys(n).reduce((function(r,e){var o=n[e];if("number"==typeof o)r[e]=t[o];else{for(var i=0;void 0===t[o[i]]&&i+1<o.length;)i++;r[e]=t[o[i]]}return r}),Object.create(null))}return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&l(t,r)}(e,RegExp),e.prototype.exec=function(r){var e=t.exec.call(this,r);if(e){e.groups=n(e,this);var o=e.indices;o&&(o.groups=n(o,this))}return e},e.prototype[Symbol.replace]=function(e,o){if("string"==typeof o){var i=r.get(this);return t[Symbol.replace].call(this,e,o.replace(/\$<([^>]+)>/g,(function(t,r){var e=i[r];return"$"+(Array.isArray(e)?e.join("$"):e)})))}if("function"==typeof o){var a=this;return t[Symbol.replace].call(this,e,(function(){var t=arguments;return"object"!=typeof t[t.length-1]&&(t=[].slice.call(t)).push(n(t,a)),o.apply(this,t)}))}return t[Symbol.replace].call(this,e,o)},c.apply(this,arguments)}function d(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),e.push.apply(e,n)}return e}function s(t){for(var r=1;r<arguments.length;r++){var e=null!=arguments[r]?arguments[r]:{};r%2?d(Object(e),!0).forEach((function(r){n(t,r,e[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):d(Object(e)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(e,r))}))}return t}var f=0,p=20,v=62;function b(t){var r,e=t.row,n=t.col,o=t.dataTable,i=(null==o||null===(r=o[e])||void 0===r||null===(r=r[n])||void 0===r?void 0:r.style)||{},a=h(t),l=a.rowCount,u=a.colCount;if(l>1){var c,d=(null==o||null===(c=o[e+l-1])||void 0===c||null===(c=c[n])||void 0===c?void 0:c.style)||{};d.hasOwnProperty("borderBottom")&&(i.borderBottom=d.borderBottom)}if(u>1){var f,p=(null==o||null===(f=o[e])||void 0===f||null===(f=f[n+u-1])||void 0===f?void 0:f.style)||{};p.hasOwnProperty("borderRight")&&(i.borderRight=p.borderRight)}return s({},i)}function h(t){var r=t.row,e=t.col,n=t.spans;return(void 0===n?[]:n).find((function(t){var n=t.row,o=t.col;return n===r&&o===e}))||{row:r,col:e,rowCount:1,colCount:1}}function y(t){for(var r=t.row,e=t.col,n=t.rowsSize,o=t.columnsSize,i=t.boxStartRow,a=void 0===i?0:i,l=function(t){for(var r=t.rowsSize,e=t.columnsSize,n=h(t),o=n.row,i=n.col,a=n.rowCount,l=n.colCount,u=0,c=o,d=o+a;c<d;){var s;u+=(null==r||null===(s=r[c])||void 0===s?void 0:s.size)||p,c+=1}for(var f=0,b=i,y=i+l;b<y;){var g;f+=(null==e||null===(g=e[b])||void 0===g?void 0:g.size)||v,b+=1}return{height:u,width:f}}(t),u=l.height,c=l.width,d=0,s=a;s<r;){var f;d+=(null==n||null===(f=n[s++])||void 0===f?void 0:f.size)||p}for(var b=0,y=0;y<e;){var g;b+=(null==o||null===(g=o[y])||void 0===g?void 0:g.size)||v,y+=1}return{height:u,width:c,x:b,y:d}}function g(t){var r=t.startRow,e=t.endRow,n=t.rowsSize,o=15;if(null!==r&&Array.isArray(n)&&n.length>0){o=0;for(var i=r+0;i<=e;){var a;o+=(null===(a=n[i])||void 0===a?void 0:a.size)||p,i+=1}}return o}function m(t){var r=[],e=t.tables[0],n=e.bindingPath;return e.columns.forEach((function(e){var o=e.dataField,i=function(t){var r=t.dataField,e=t.dsList,n=t.bindingPath,o=e.find((function(t){return t.code===n})),i=o.children.find((function(t){return t.code===r}))||{},a=function(t){var r=t.dataField;return{fieldDescription:{props:{},staticValue:r}}}(s(s({},t),{},{dataField:i.code}));return{field:{props:{name:`${r}`,class:S(i.type)},childrens:[a]}}}(s(s({},t),{},{bindingPath:n,dataField:o}));r.push(i)})),r}var w={text:"java.lang.String",integer:"java.lang.Integer",decimals:"java.lang.Double"};function S(t){return w[t]||"java.lang.String"}function O(t){var r=t.dsList,e=[];return r.forEach((function(r){if("table"!==(null==r?void 0:r.type)){var n=function(t){var r=t.dsListItem,e=r.code,n=r.type;return{parameter:{props:{name:e,isForPrompting:!0,class:S(n)}}}}(s(s({},t),{},{dsListItem:r}));e.push(n)}})),e}function j(t){var r=function(t){var r=t.tables,e=r[0],n=e.row,o=e.rowCount,i=n+o-1;function a(t){return t>i}return C(s(s({},t),{},{condition:a}))}(t);return{columnFooter:{childrens:[r],rect:r.band.bandRect}}}function C(t){var r=t.dataTable,e=t.rowsSize,n=t.condition,o=[],i=null,a=null,l=null,c=null;return Object.entries(r).forEach((function(r){var e=u(r,2),d=e[0],f=e[1],p=Number(d);n(p)&&Object.entries(f).forEach((function(r){var e=u(r,2),n=e[0],d=e[1],f=d.value,v=d.bindingPath;if(d.style,f||v){var h=Number(n);null===i&&(i=p),a=p,null===l&&(l=h),h>l&&(l=h),null===c&&(c=h),h<c&&(c=h);var y=s(s({},t),{},{row:p,col:h,dataField:v,staticValue:f,boxStartRow:i});y.style=b(y);var g=T(y);o.push(g)}}))})),{band:{props:{height:g({startRow:i,endRow:a,rowsSize:e}),isSplitAllowed:"false"},childrens:o,bandRect:{startRow:i,startCol:c,endRow:a,endCol:l}}}}function R(t){var r=function(t){var r=t.tables,e=r[0].row;function n(t){return t<e}return C(s(s({},t),{},{condition:n}))}(t);return{pageHeader:{childrens:[r],rect:r.band.bandRect}}}function P(t){var r=function(t){var r=t.tables,e=t.rowsSize,n=r[0],o=n.row,i=n.col,a=n.rowCount,l=n.colCount;n.bindingPath;var u=n.columns,c=[];return u.forEach((function(r,e){var n=r.dataField,a=i+e,l=s(s({},t),{},{row:o,col:a,dataField:n,boxStartRow:o,type:"F"});l.style=b(l);var u=T(l);c.push(u)})),{band:{props:{height:g({startRow:o,endRow:o,rowsSize:e}),isSplitAllowed:"false"},childrens:c,bandRect:{startRow:o,startCol:i,endRow:o+a-1,endCol:i+l-1}}}}(t);return{detail:{childrens:[r],rect:r.band.bandRect}}}function T(t){var r=function(t){var r=t.style,e=y(t),n=s(s({mode:"Transparent"},e),{},{key:"textField-"+ ++f,stretchType:"RelativeToBandHeight"});if(r){var o={backColor:!0,foreColor:!0};Object.keys(o).forEach((function(t){r[t]&&(n[t.toLowerCase()]=r[t])}))}return{reportElement:{props:n}}}(t),e=function(t){var r=t.style,e="#000000",n="None",o="1",i={topBorder:n,topBorderColor:e,leftBorder:n,leftBorderColor:e,leftPadding:o,rightBorder:n,rightBorderColor:e,rightPadding:o,bottomBorder:n,bottomBorderColor:e,bottomPadding:o},a={0:"Empty",1:"Thin",2:"Medium",3:"Dashed",4:"Dotted",5:"Thick",6:"Double",7:"Hair",8:"MediumDashed",9:"DashDot",10:"MediumDashDot",11:"DashDotDot",12:"MediumDashDotDot",13:"SlantedDashDot"};if(r){var l={borderTop:{id:"topBorder",colorKey:"topBorderColor"},borderRight:{id:"rightBorder",colorKey:"rightBorderColor"},borderBottom:{id:"bottomBorder",colorKey:"bottomBorderColor"},borderLeft:{id:"leftBorder",colorKey:"leftBorderColor"}};Object.entries(l).forEach((function(t){var n=u(t,2),o=n[0],l=n[1],c=l.id,d=l.colorKey,s=r[o];s&&(i[c]=a[s.style],i[d]=s.color||e)}))}return{box:{props:i}}}(t),n=function(t){var r=t.style,e={0:"Top",1:"Middle",2:"Bottom"},n="Top",o="Left",i={textAlignment:{0:"Left",1:"Center",2:"Right",3:"Left",4:"CenterContinuous"}[null==r?void 0:r.hAlign]||o,verticalAlignment:e[null==r?void 0:r.vAlign]||n,rotation:"None",lineSpacing:"Single"},a=function(t){var r=t.style,e="Calibri",n="11",o=null==r?void 0:r.font;if(o){var i,a=c(/\b(\d+)\.?\d*?(?:pt|px)/,{size:1});n=(null===(i=o.match(a))||void 0===i||null===(i=i.groups)||void 0===i?void 0:i.size)||"1";var l=o.match(/"([^"]+)"/)||o.match(/(\S+)$/);l&&(e=l[1])}var u={fontName:e,pdfFontName:"STSong-Light",size:n,isPdfEmbedded:"true",pdfEncoding:"UniGB-UCS2-H"};return{font:{props:u}}}(t);return{textElement:{props:i,childrens:[a]}}}(t),o=function(t){var r=t.dataField,e=t.staticValue,n=t.type;return{textFieldExpression:{props:{class:"java.lang.String"},dataField:r,staticValue:e,type:n}}}(t);return{textField:{props:{isStretchWithOverflow:"true",pattern:"",isBlankWhenNull:"true",evaluationTime:"Now",hyperlinkType:"None",hyperlinkTarget:"Self"},childrens:[r,e,n,o]}}}var D=1;function E(t){var r=O(t),e=m(t),n=R(t),o=P(t),i=j(t),l=function(t){for(var r=t.columnsSize,e=t.pageHeader,n=t.detail,o=t.columnFooter,i=[e.pageHeader.rect,n.detail.rect,o.columnFooter.rect].reduce((function(t,r){var e=r.endRow,n=r.endCol;return n&&n>t.endCol&&(t.endCol=n),e&&e>t.endRow&&(t.endRow=e),t}),{startRow:0,startCol:0,endRow:0,endCol:0}).endCol,a=0,l=84;a<=i;){var u;l+=(null==r||null===(u=r[a])||void 0===u?void 0:u.size)||v,a+=1}return{pageWidth:l,topMargin:42,rightMargin:42,bottomMargin:42,leftMargin:42}}({columnsSize:t.columnsSize,pageHeader:n,detail:o,columnFooter:i}),u=l.pageWidth,c=l.topMargin,d=l.rightMargin,s=l.bottomMargin,f=l.leftMargin;return{jasperReport:{props:{name:function(){var t=new Date,r=`报表${t.getFullYear()}${t.getMonth()+1}${t.getDate()}${D.toString().padStart(4,"0")}`;return D++,r}(),columnCount:"1",printOrder:"Vertical",orientation:"Landscape",pageWidth:u,columnSpacing:"0",leftMargin:f,rightMargin:d,topMargin:c,bottomMargin:s,whenNoDataType:"AllSectionsNoDetail",isTitleNewPage:"false",isSummaryNewPage:"false"},childrens:[].concat(a(r),a(e),[n,o,i])}}}function A(t){var r="";return Object.entries(t).forEach((function(t){var e=u(t,2),n=e[0],o=e[1],i=o.props,a=void 0===i?{}:i,l=o.childrens,c=o.dataField,d=o.staticValue,s=o.type,f=void 0===s?"P":s,p=Object.entries(a).reduce((function(t,r){var e=u(r,2);return t+=` ${e[0]}="${e[1]}"`}),`<${n}`);p+=" >",Array.isArray(l)&&l.length>0&&l.forEach((function(t){p+=`${A(t)}`})),c?p+=`<![CDATA[$${f}{${c}}]]>`:d&&(p+=`<![CDATA["${d}"]]>`),r=`${p}${`</${n}>`}`})),r}function x(t){var r=t.spreadJsonData,e=t.dsList,n=r.sheets[Object.keys(r.sheets)[0]],o=n.tables,i=n.columns,a=n.rows;return A(E({tables:o,dataTable:n.data.dataTable,columnsSize:i,rowsSize:a,dsList:e,spans:n.spans}))}return function(){function t(r,e){!function(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,t),n(this,"data",{}),n(this,"ctx",{}),this.data=r,this.ctx=e}var r,o,i;return r=t,(o=[{key:"transform",value:function(){return x({spreadJsonData:this.data,dsList:this.ctx.dsList})}}])&&e(r.prototype,o),i&&e(r,i),Object.defineProperty(r,"prototype",{writable:!1}),t}()}));
