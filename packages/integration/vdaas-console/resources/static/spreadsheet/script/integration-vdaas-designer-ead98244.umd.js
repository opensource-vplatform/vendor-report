!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(e){var n=function(e,n){if("object"!=t(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,n||"default");if("object"!=t(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==t(n)?n:String(n)}function n(t,e){if(null==t)return{};var n,r,o=function(t,e){if(null==t)return{};var n,r,o={},i=Object.keys(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)>=0||(o[n]=t[n]);return o}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(o[n]=t[n])}return o}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function o(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==e);u=!0);}catch(s){c=!0,o=s}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(t,e)||function(t,e){if(t){if("string"==typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return a(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,l=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return l=t.done,t},e:function(t){u=!0,i=t},f:function(){try{l||null==n.return||n.return()}finally{if(u)throw i}}}}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var l,u=new URLSearchParams(window.location.search),c=window.location.origin,s=function(t){return u.get(t)},f=function(){return u.get("id")||Math.random().toString(36).slice(2)+Math.random().toString(36).slice(2)+Math.random().toString(36).slice(2)+Date.now().toString(36)},d=function(){var t=s("ctxPath");return t?c+"/"+t:c},y=function(){var t=function(t){t=t||[];var e,n=[],r=i(u.entries());try{for(r.s();!(e=r.n()).done;){var a=o(e.value,2),l=a[0],c=a[1];-1==t.indexOf(l)&&n.push(`${l}=${encodeURIComponent(c)}`)}}catch(s){r.e(s)}finally{r.f()}return n.join("&")}();return""!=t?"&"+t:""},m=function(){return`${d()}/webapi/innersysapi/VDassDbmsConsole/report?operate=queryMetadatas${y()}`},v=["type","children","code","name"];function b(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function p(t){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?b(Object(r),!0).forEach((function(n){var o,i,a;o=t,i=n,a=r[n],(i=e(i))in o?Object.defineProperty(o,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):o[i]=a})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}document.title=(l="同望电子表格设计器",s("reportTitle")||l);var g=TOONE.Report.Designer,h=g.Utils,w=h.RPC,O=h.msg,S=function t(e){if(e&&e.data){var n=e.data;return!1===n.success?n.msg||"存在未知异常！":t(n)}return null},j={table:"table",query:"table",api:"table",char:"text",text:"text",number:"decimals",boolean:"text",date:"text",longDate:"text",file:"text",object:"text",integer:"integer"},R=function(t){return j[t]},I=function t(e){return e.map((function(e){var r=e.type,o=e.children,i=e.code,a=e.name,l=n(e,v);return p(p({},l),{},o?{code:i,name:a||i,type:R(r),children:t(o)}:{code:i,name:a||i,type:R(r)})}))};new g({nav:{file:!0,table:{tableOptions:!1}},dataSource:{allowToView:!1,allowToEdit:!1},event:{onSave:function(t,e){return new Promise((function(n,r){t.usedDatasources=function(t){var e=[];return t&&t.define&&t.define.forEach((function(t){e.push(t.code)})),e}(e),t.selectedDatasources=function(t){var e=[];return t&&t.dsList&&t.dsList.forEach((function(t){e.push(t.code)})),e}(e);var o=JSON.stringify(t),i={id:f(),config:o,icon:null,preview:e.toImage(),requestTables:""};w.post(`${d()}/webapi/innersysapi/VDassDbmsConsole/report?operate=saveReportConfig${y()}`,i).then((function(t){var e,o;null!=t&&null!==(e=t.data)&&void 0!==e&&e.success?n({success:!0}):r({success:!1,message:null==t||null===(o=t.data)||void 0===o?void 0:o.message})})).catch((function(t){r({success:!1,message:"出现未知异常！"})}))}))},onDatasourceSelectVisible:function(){return new Promise((function(t,e){w.get(m()).then((function(n){var r,o=S(n);if(null!=o)return e(Error(o));t(I((null==n||null===(r=n.data)||void 0===r||null===(r=r.data)||void 0===r?void 0:r.define)||[]))})).catch(e)}))},onDesignerInited:function(){return new Promise((function(t,e){w.get(`${d()}/webapi/innersysapi/VDassDbmsConsole/report?operate=queryReportConfig${y()}`).then((function(n){var r,o,i=S(n);if(null!=i)return e(Error(i));var a=null;if(null!=n&&null!==(r=n.data)&&void 0!==r&&null!==(r=r.data)&&void 0!==r&&null!==(r=r.data)&&void 0!==r&&r.config)try{a=JSON.parse(n.data.data.data.config)}catch(u){}var l=null===(o=a)||void 0===o?void 0:o.selectedDatasources;l&&l.length>0?w.get(m()+"&requestTables="+l.join(",")).then((function(n){var r,o=S(n);if(null!=o)return e(Error(o));t({tableMetadata:I((null==n||null===(r=n.data)||void 0===r||null===(r=r.data)||void 0===r?void 0:r.define)||[]),excelJson:a?a.reportJson:null})})).catch(e):t({tableMetadata:[],excelJson:a?a.reportJson:null})})).catch(e)}))}},license:"service.vdaas.t.vtoone.com|dev.service.vdaas.t.vtoone.com|console.vdaas.t.vtoone.com|dev.console.vdaas.t.vtoone.com|test.service.vdaas.t.vtoone.com|test.console.vdaas.t.vtoone.com,161989545757192#B1fVQRFZzSltWNBhHO5EmU8Y7dilGexkDTERlaZJzTLRDUatUWFZTMN34LsZDRpdFTKdzaK3WbDlVUUJHewwmMmdlSlVmVGJlaUFkQEVER6x6VodUOZdnNIhHOQl6S8kHV4UUcUFWRUNGbaxEa5UDdrdFTrhEZ5xUMstSTvIERvp7NPNlM8t6aJdmc6RWVvdjRSRVaPd4QqJUckZGORVTNVFDV9VneNxUaHNWWqRURPRGSN9ka4gzcr4mYxVEOWljYPp6ZQpHOIZFUulDZxMTMsVTdZFTU5I6YrVzQFlndndEeU9kYLNGVIBDUr4mNiJkRtd6aTRXNndzSrgXasd4Z7g6N5c4RRlFSaNkViVTMupHVRZ7YB3EdTR7aBdFWvgFcEtGOyJDaFRmWhNTewoUZ4oGanZmN9R5NjhUQHR5cNhjMtZTdjlkR5dTeKVlI0IyUiwiIxkjNwAjQyYjI0ICSiwiM9UTN4UjNxQTM0IicfJye#4Xfd5nIVF4SRJiOiMkIsIyNx8idgMlSgQWYlJHcTJiOi8kI1tlOiQmcQJCLiMjMyQjNwASOyQDM4IDMyIiOiQncDJCLi46bj9SZu36b4ZnL49ychFGZ69SZs36cu36YuQ7clRHLt36YuUmbv3Gd69CduMXYhRmduU6YpZnclNnL4NXZ4xSbvNmLl96bvRnduQnLzFWYkZnLlx6bz96bj9idlRGLt36YuUmbv3Gd69CduMXYhRmduUGbvNnbvNGLt36YuUmbv3Gd69CduMXYhRmduU6YpZnclNnL6VGZs46bj9SZu36b4ZnL49ychFGZ69SZjlmdyV6ciojIz5GRiwiI8+Y9sWY9QmZ0Jyp9cu19R6197CL09yb96OZ07Wr9g+89iojIh94QiwiIykTM7UzN5QTN9gTOxYTMiojIklkIs4XXbpjInxmZiwSZzxWYmpjIyNHZisnOiwmbBJye0ICRiwiI34TQUd6RKZVN2Z3d",toolbar:[{title:"关闭",type:"warning",onClick(){O.confirm("","确定关闭设计器吗？",(function(t){t&&(window.opener=null,window.open("","_self"),window.close())}))}}]}).mount(document.getElementById("app"))}));
