!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(e){var n=function(e,n){if("object"!=t(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,n||"default");if("object"!=t(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==t(n)?n:String(n)}function n(t,e){if(null==t)return{};var n,r,o=function(t,e){if(null==t)return{};var n,r,o={},i=Object.keys(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)>=0||(o[n]=t[n]);return o}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(o[n]=t[n])}return o}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function o(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i,a,u=[],l=!0,c=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=i.call(n)).done)&&(u.push(r.value),u.length!==e);l=!0);}catch(s){c=!0,o=s}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return u}}(t,e)||function(t,e){if(t){if("string"==typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return a(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,l=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return u=t.done,t},e:function(t){l=!0,i=t},f:function(){try{u||null==n.return||n.return()}finally{if(l)throw i}}}}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var u,l=new URLSearchParams(window.location.search),c=window.location.origin,s=function(t){return l.get(t)},d=function(){return l.get("id")||Math.random().toString(36).slice(2)+Math.random().toString(36).slice(2)+Math.random().toString(36).slice(2)+Date.now().toString(36)},f=function(){var t=s("ctxPath");return t?c+"/"+t:c},v=function(){var t=function(t){t=t||[];var e,n=[],r=i(l.entries());try{for(r.s();!(e=r.n()).done;){var a=o(e.value,2),u=a[0],c=a[1];-1==t.indexOf(u)&&n.push(`${u}=${encodeURIComponent(c)}`)}}catch(s){r.e(s)}finally{r.f()}return n.join("&")}();return""!=t?"&"+t:""},m=function(){return`${f()}/webapi/innersysapi/VDassDbmsConsole/report?operate=queryMetadatas${v()}`},p=[{min:4e4,max:49999}],y=function(t,e){return function(t){var e=t.errorCode;if(!isNaN(e))for(var n=parseInt(e),r=0;r<p.length;r++){var o=p[r];if(n>=o.min&&n<=o.max)return!0}return!1}(t)?{title:t.title||e,detail:t.msg||t.message||""}:{title:e,detail:t.msg||t.message||""}},b=function t(e,n){return function(t){return!1===t.success}(e)?y(e,n):e.data?t(e.data,n):null},g=function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e)return null;if(r){var o=null;return e.data&&(o=t(e.data,n,r)),o||(o=e[n]||null),o}var i=e[n];return i||(e.data?t(e.data,n,r):null)},h=function(t){return function(e){return t(new Error(function(t){var e,n,r,o,i;return 404==(null==t||null===(e=t.response)||void 0===e?void 0:e.status)?"网络异常":null!==(n=null!==(r=null==t||null===(o=t.response)||void 0===o||null===(o=o.data)||void 0===o?void 0:o.msg)&&void 0!==r?r:null==t||null===(i=t.response)||void 0===i||null===(i=i.data)||void 0===i||null===(i=i.data)||void 0===i?void 0:i.msg)&&void 0!==n?n:t.message}(e)))}},w=function(t,e,n){var r=b(t,n);return null!=r&&(e(Error(r.title)),!0)},S=["type","children","code","name"];function O(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function j(t){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?O(Object(r),!0).forEach((function(n){var o,i,a;o=t,i=n,a=r[n],(i=e(i))in o?Object.defineProperty(o,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):o[i]=a})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):O(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}document.title=(u="同望电子表格设计器",s("reportTitle")||u);var R=TOONE.Report.Designer,N=R.Utils,I=N.RPC,U=N.msg,Z=function(t){var e=[];return t&&t.define&&t.define.forEach((function(t){e.push(t.code)})),e},x={apiView:"table",mode:"table",view:"table",char:"text",text:"text",number:"decimals",boolean:"text",date:"text",longDate:"text",file:"text",object:"text",integer:"integer"},D=function(t){return x[t]},T=function t(e){return e.map((function(e){var r=e.type,o=e.children,i=e.code,a=e.name,u=n(e,S);return j(j({},u),{},o?{code:i,name:a||i,type:D(r),children:t(o)}:{code:i,name:a||i,type:D(r)})}))};new R({baseUrl:"../",nav:{table:{tableOptions:!1}},dataSource:{allowToEdit:!1},event:{onSave:function(t,e){return new Promise((function(n,r){t.usedDatasources=Z(e),t.selectedDatasources=function(t){var e=[];return t&&t.dsList&&t.dsList.forEach((function(t){e.push(t.code)})),e}(e),t.datasourceSetting=e.datasourceSetting;var o=JSON.stringify(t),i={id:d(),config:o,icon:null,preview:e.toImage(),requestTables:""};I.post(`${f()}/webapi/innersysapi/VDassDbmsConsole/report?operate=saveReportConfig${v()}`,i).then((function(t){w(t,r,"保存报表失败！")||n({success:!0})})).catch(h(r))}))},onDatasourceSelectVisible:function(){return new Promise((function(t,e){I.get(m()).then((function(n){w(n,e,"获取数据集定义信息失败！")||t(T(g(n.data,"define")||[]))})).catch(h(e))}))},onDesignerInited:function(){return new Promise((function(t,e){I.get(`${f()}/webapi/innersysapi/VDassDbmsConsole/report?operate=queryReportConfig${v()}`).then((function(n){if(!w(n,e,"获取报表配置信息失败！")){var r,o=null;try{o=JSON.parse(g(n.data,"config"))}catch(c){}var i,a,u,l=null===(r=o)||void 0===r?void 0:r.selectedDatasources;if(l&&l.length>0)I.get(m()+"&requestTables="+l.join(",")).then((function(n){var r,i,a;w(n,e,"获取数据集定义信息失败！")||t({tableMetadata:T(g(n.data,"define")||[]),excelJson:(null===(r=o)||void 0===r?void 0:r.reportJson)||null,datasourceSetting:(null===(i=o)||void 0===i?void 0:i.datasourceSetting)||{},wizardSlice:null===(a=o)||void 0===a||null===(a=a.context)||void 0===a?void 0:a.wizardSlice})})).catch(h(e));else t({tableMetadata:[],excelJson:(null===(i=o)||void 0===i?void 0:i.reportJson)||null,datasourceSetting:(null===(a=o)||void 0===a?void 0:a.datasourceSetting)||{},wizardSlice:null===(u=o)||void 0===u||null===(u=u.context)||void 0===u?void 0:u.wizardSlice})}})).catch(h(e))}))},onPreview:function(t){return new Promise((function(e,n){var r,o=Z(t);I.get((r=o.join(","),`${f()}/webapi/innersysapi/VDassDbmsConsole/report?operate=queryData${v()}&requestTables=${r}`)).then((function(t){w(t,n,"获取数据集数据失败！")||e(g(t.data,"data",!0))})).catch(h(n))}))}},license:"service.vdaas.t.vtoone.com|dev.service.vdaas.t.vtoone.com|console.vdaas.t.vtoone.com|dev.console.vdaas.t.vtoone.com|test.service.vdaas.t.vtoone.com|test.console.vdaas.t.vtoone.com,161989545757192#B1fVQRFZzSltWNBhHO5EmU8Y7dilGexkDTERlaZJzTLRDUatUWFZTMN34LsZDRpdFTKdzaK3WbDlVUUJHewwmMmdlSlVmVGJlaUFkQEVER6x6VodUOZdnNIhHOQl6S8kHV4UUcUFWRUNGbaxEa5UDdrdFTrhEZ5xUMstSTvIERvp7NPNlM8t6aJdmc6RWVvdjRSRVaPd4QqJUckZGORVTNVFDV9VneNxUaHNWWqRURPRGSN9ka4gzcr4mYxVEOWljYPp6ZQpHOIZFUulDZxMTMsVTdZFTU5I6YrVzQFlndndEeU9kYLNGVIBDUr4mNiJkRtd6aTRXNndzSrgXasd4Z7g6N5c4RRlFSaNkViVTMupHVRZ7YB3EdTR7aBdFWvgFcEtGOyJDaFRmWhNTewoUZ4oGanZmN9R5NjhUQHR5cNhjMtZTdjlkR5dTeKVlI0IyUiwiIxkjNwAjQyYjI0ICSiwiM9UTN4UjNxQTM0IicfJye#4Xfd5nIVF4SRJiOiMkIsIyNx8idgMlSgQWYlJHcTJiOi8kI1tlOiQmcQJCLiMjMyQjNwASOyQDM4IDMyIiOiQncDJCLi46bj9SZu36b4ZnL49ychFGZ69SZs36cu36YuQ7clRHLt36YuUmbv3Gd69CduMXYhRmduU6YpZnclNnL4NXZ4xSbvNmLl96bvRnduQnLzFWYkZnLlx6bz96bj9idlRGLt36YuUmbv3Gd69CduMXYhRmduUGbvNnbvNGLt36YuUmbv3Gd69CduMXYhRmduU6YpZnclNnL6VGZs46bj9SZu36b4ZnL49ychFGZ69SZjlmdyV6ciojIz5GRiwiI8+Y9sWY9QmZ0Jyp9cu19R6197CL09yb96OZ07Wr9g+89iojIh94QiwiIykTM7UzN5QTN9gTOxYTMiojIklkIs4XXbpjInxmZiwSZzxWYmpjIyNHZisnOiwmbBJye0ICRiwiI34TQUd6RKZVN2Z3d",toolbar:[{title:"关闭",type:"warning",onClick(){U.confirm("","确定关闭设计器吗？",(function(t){t&&(window.opener=null,window.open("","_self"),window.close())}))}}]}).mount(document.getElementById("app"))}));
