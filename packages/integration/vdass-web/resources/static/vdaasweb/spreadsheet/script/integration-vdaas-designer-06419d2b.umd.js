!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";function t(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function e(e,n){return function(t){if(Array.isArray(t))return t}(e)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==e);u=!0);}catch(f){c=!0,o=f}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,n)||function(e,n){if(e){if("string"==typeof e)return t(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?t(e,n):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t){var e=function(t,e){if("object"!=n(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var o=r.call(t,e||"default");if("object"!=n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==n(e)?e:String(e)}function o(t,e){if(null==t)return{};var n,r,o=function(t,e){if(null==t)return{};var n,r,o={},i=Object.keys(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)>=0||(o[n]=t[n]);return o}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(o[n]=t[n])}return o}function i(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return a(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,l=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return l=t.done,t},e:function(t){u=!0,i=t},f:function(){try{l||null==n.return||n.return()}finally{if(u)throw i}}}}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var l,u=new URLSearchParams(window.location.search),c=window.location.origin,f=function(t){return u.get(t)},s=function(){return u.get("id")||Math.random().toString(36).slice(2)+Math.random().toString(36).slice(2)+Math.random().toString(36).slice(2)+Date.now().toString(36)},d=function(){var t=f("ctxPath");return t?c+"/"+t:c},y=function(){var t=function(t){t=t||[];var n,r=[],o=i(u.entries());try{for(o.s();!(n=o.n()).done;){var a=e(n.value,2),l=a[0],c=a[1];-1==t.indexOf(l)&&r.push(`${l}=${encodeURIComponent(c)}`)}}catch(f){o.e(f)}finally{o.f()}return r.join("&")}(["tenant","id"]);return`?tenant=${f("tenant")}&id=${s()}${""!=t?"&"+t:""}`},m=function(){return f("appcode")},v=["type","children","code","name"];function p(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function b(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?p(Object(n),!0).forEach((function(e){var o,i,a;o=t,i=e,a=n[e],(i=r(i))in o?Object.defineProperty(o,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):o[i]=a})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}document.title=(l="同望电子表格设计器",f("title")||l);var g=TOONE.Report.Designer,h=g.Utils,O=h.RPC,w=h.msg,S=function t(e){if(e&&e.data){var n=e.data;return!1===n.success?n.msg||"存在未知异常！":t(n)}return null},j={table:"table",query:"table",api:"table",char:"text",text:"text",number:"decimals",boolean:"text",date:"text",longDate:"text",file:"text",object:"text",integer:"integer"},R=function(t){return j[t]},I=function t(e){return e.map((function(e){var n=e.type,r=e.children,i=e.code,a=e.name,l=o(e,v);return b(b({},l),{},r?{code:i,name:a||i,type:R(n),children:t(r)}:{code:i,name:a||i,type:R(n)})}))};new g({nav:{file:!0,table:{tableOptions:!1}},dataSource:{allowToView:!1,allowToEdit:!1},event:{onSave:function(t,e){return new Promise((function(n,r){t.usedDatasources=function(t){var e=[];return t&&t.define&&t.define.forEach((function(t){e.push(t.code)})),e}(e);var o=JSON.stringify(t),i={id:s(),config:o,icon:null,preview:e.toImage(),requestTables:""};O.post(`${d()}/sysapi/${m()}/report/saveReportConfig${y()}`,i).then((function(t){var e,o;null!=t&&null!==(e=t.data)&&void 0!==e&&e.success?n({success:!0}):r({success:!1,message:null==t||null===(o=t.data)||void 0===o?void 0:o.message})})).catch((function(t){r({success:!1,message:"出现未知异常！"})}))}))},onDesignerInited:function(){return new Promise((function(t,n){var r=[O.get(`${d()}/sysapi/${m()}/report/queryMetadatas${y()}`),O.get(`${d()}/sysapi/${m()}/report/queryReportConfig${y()}`)];Promise.all(r).then((function(r){var o,i,a=e(r,2),l=a[0],u=a[1],c=S(l);if(null!=(c=null==c?S(u):null))return n(Error(c));var f=null;if(null!=u&&null!==(o=u.data)&&void 0!==o&&null!==(o=o.data)&&void 0!==o&&null!==(o=o.data)&&void 0!==o&&o.config)try{f=JSON.parse(u.data.data.data.config)}catch(s){}t({tableMetadata:I((null==l||null===(i=l.data)||void 0===i||null===(i=i.data)||void 0===i?void 0:i.define)||[]),excelJson:f?f.reportJson:null})})).catch(n)}))}},license:"service.vdaas.t.vtoone.com|dev.service.vdaas.t.vtoone.com|console.vdaas.t.vtoone.com|dev.console.vdaas.t.vtoone.com|test.service.vdaas.t.vtoone.com|test.console.vdaas.t.vtoone.com,161989545757192#B1fVQRFZzSltWNBhHO5EmU8Y7dilGexkDTERlaZJzTLRDUatUWFZTMN34LsZDRpdFTKdzaK3WbDlVUUJHewwmMmdlSlVmVGJlaUFkQEVER6x6VodUOZdnNIhHOQl6S8kHV4UUcUFWRUNGbaxEa5UDdrdFTrhEZ5xUMstSTvIERvp7NPNlM8t6aJdmc6RWVvdjRSRVaPd4QqJUckZGORVTNVFDV9VneNxUaHNWWqRURPRGSN9ka4gzcr4mYxVEOWljYPp6ZQpHOIZFUulDZxMTMsVTdZFTU5I6YrVzQFlndndEeU9kYLNGVIBDUr4mNiJkRtd6aTRXNndzSrgXasd4Z7g6N5c4RRlFSaNkViVTMupHVRZ7YB3EdTR7aBdFWvgFcEtGOyJDaFRmWhNTewoUZ4oGanZmN9R5NjhUQHR5cNhjMtZTdjlkR5dTeKVlI0IyUiwiIxkjNwAjQyYjI0ICSiwiM9UTN4UjNxQTM0IicfJye#4Xfd5nIVF4SRJiOiMkIsIyNx8idgMlSgQWYlJHcTJiOi8kI1tlOiQmcQJCLiMjMyQjNwASOyQDM4IDMyIiOiQncDJCLi46bj9SZu36b4ZnL49ychFGZ69SZs36cu36YuQ7clRHLt36YuUmbv3Gd69CduMXYhRmduU6YpZnclNnL4NXZ4xSbvNmLl96bvRnduQnLzFWYkZnLlx6bz96bj9idlRGLt36YuUmbv3Gd69CduMXYhRmduUGbvNnbvNGLt36YuUmbv3Gd69CduMXYhRmduU6YpZnclNnL6VGZs46bj9SZu36b4ZnL49ychFGZ69SZjlmdyV6ciojIz5GRiwiI8+Y9sWY9QmZ0Jyp9cu19R6197CL09yb96OZ07Wr9g+89iojIh94QiwiIykTM7UzN5QTN9gTOxYTMiojIklkIs4XXbpjInxmZiwSZzxWYmpjIyNHZisnOiwmbBJye0ICRiwiI34TQUd6RKZVN2Z3d",toolbar:[{title:"关闭",type:"warning",onClick(){w.confirm("","确定关闭设计器吗？",(function(t){t&&(window.opener=null,window.open("","_self"),window.close())}))}}]}).mount(document.getElementById("app"))}));
